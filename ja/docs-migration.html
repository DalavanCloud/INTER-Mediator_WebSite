<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link href="/pagestyle.css" rel="stylesheet" media="screen"/>
    <link rel="shortcut icon" href="/im-icon.png" type="image/png"/>
    <link rel="icon" href="/im-icon.png" type="image/png"/>
    <title>INTER-Mediator</title>
    <script type="text/javascript" language="JavaScript">
        var htmlDocumentModDate = document.lastModified;
    </script>
    <script type="text/javascript" language="JavaScript" src="/pagebuilder.js"></script>
    <script type="text/javascript" language="JavaScript" src="/files/jquery-1.10.2.min.js"></script>
</head>
<body>
<div id="navigationbox" class="graybox">
    <div id="navigation"></div>
    <div id="latestnews"></div>
</div>
<div id="page_header"></div>
<div id="page_contents">
    <h2>INTER-Mediatorのバージョン移行ガイド</h2>
    <p>INTER-Mediatorもバージョンを重ねてきており、以前の引き継がなくなってしまった箇所が出てきています。Ver.3 (2012/12/10) 以降の大きな変更点、つまりアプリケーション側を書き換えないといけないような変更をここにまとめておきます。</p>

    <h3>Ver.4.6 (in developement) での変更</h3>
    <p>コンテキストを利用して読み出しを行うとき、JavaScriptで検索条件や並べ替え条件を付加できるプロパティadditionalConditionとadditionalSortKeyがあります。これらは、従来までは単純にオブジェクトを記録していただけですが、Ver.4.4あたりでローカルコンテキストに記録して、ページを改めて呼び出した時にローカルコンテキストを復活させることで元に戻すという仕様を組み込みました。しかしながら、その動作を見直している時にバグが見つかりましたが、結果的に、additionalConditionとadditionalSortKeyの参照は変更は必要ですが、追加や書き換えには以下のような変更が必要になります。これらの2つのプロパティにセッタとゲッタを設定しているため、セッタを稼働させるために、プロパティそのものへの代入が必要になります。</p>

    <div class="code">
<pre><code>INTERMediator.additionalCondition["acontext"] = [];
INTERMediator.additionalCondition["acontext"].push({field: "afield", operator: "=", value: "1001"});
INTERMediator.additionalCondition["acontext"].push({field: "live", operator: "=", value: "1"});
    ↓
var conditions = INTERMediator.additionalCondition;
conditions["acontext"] = [];
conditions["acontext"].push({field: "afield", operator: "=", value: "1001"});
conditions["acontext"].push({field: "live", operator: "=", value: "1"});
INTERMediator.additionalCondition = conditions</code></pre>
    </div>

    <p>検索条件が1つだけの場合も、同様に、次のように書き換えが必要になります。</p>

    <div class="code">
<pre><code>INTERMediator.additionalCondition["acontext"] = {field: "afield", operator: "=", value: "1001"};
    ↓
var conditions = INTERMediator.additionalCondition;
conditions["acontext"].push({field: "afield", operator: "=", value: "1001"});
INTERMediator.additionalCondition = conditions</code></pre>
    </div>

    <h3>Ver.4.1 (2014/2/7) での変更</h3>
    <p>ターゲット指定をclass属性に独自の記述方法で書いていましたが、Ver.4.1より、HTML5のdata属性での記述に移行しました。なお、従来の記述も基本的にはそのまま利用できるはずですが、大した手間にならないので、書き直すのがいいかと思います。</p>
    <div class="table">
    <table>
        <tr><th>以前の表記法</th><th>Ver.4.1以降の表記法</th><th>利用場所</th></tr>
        <tr><td>class="IM[...]"</td><td>data-im="..."</td><td>ページファイルのターゲット指定</td></tr>
        <tr><td>class="IM_WIDGET[...]"</td><td>data-im-widget="..."</td><td>JavaScriptコンポーネントの指定</td></tr>
        <tr><td>class="_im_enclosure"</td><td>data-im-control="enclosure"</td><td>エンクロージャにしたいDIV, SPANタグ</td></tr>
        <tr><td>class="_im_repeater"</td><td>data-im-control="repeater"</td><td>リピータにしたいDIV, SPANタグ</td></tr>
        <tr><td>class="_im_ignore_enc_rep"</td><td>data-im-control="ignore_enc_rep"</td><td>リピータあるいはエンクロージャでなくする</td></tr>
        <tr><td>class="_im_for_noresult_"</td><td>data-im-control="noresult"</td><td>検索結果が0レコードの時に表示されるリピータ</td></tr>
        <tr><td>class="_im_post"</td><td>data-im-control="post"</td><td>ポストオンリーモードのエンクロージャおよび書き込みボタン</td></tr>
        <tr><td>name="IM[...]"</td><td>data-im-group="...."</td><td>ポストオンリーモードでのラジオボタンのグループ指定</td></tr>
    </table>
    </div>
    <p>以下は書き換え例です。</p>
    <div class="code">
<pre><code>&lt;input class="IM[mytable@anyfield]" /&gt;
    ↓
&lt;input data-im="mytable@anyfield" /&gt;</code></pre>
    </div>
    <p>IM[]に複数のターゲット指定を書いていた場合、|で区切っていましたが、空白で区切れるようになりました。</p>
    <div class="code">
<pre><code>&lt;option class="IM[mytable@myvalue@value|mytable@myname]" /&gt;
    ↓
&lt;option data-im="mytable@myvalue@value mytable@myname" /&gt;</code></pre>
    </div>

    <h3>Ver.4.0 (2013/12/4) での変更</h3>
    <p>INTER-Mediatorの配布ファイルのファイル構成が変わりました。ルート直下にフレームワークがあり、サンプルファイルはSamplesの下に配備しました。同時に、dist-docs/buildup.shを利用して、運用向けのフレームワークを用意する機能を加えています。<a href="docs-deploy.html">こちら</a>をごらんください。</p>

    <h3>Ver.3.8 (2013/8/22) での変更</h3>
    <p>$params.phpファイルにおいて記述できていた$scriptPathPrefix、$scriptPathSufixを利用して、クライアントから呼び出すURLをコントロールできていましたが、$callURLという変数で完全にURLで指定できるようにしています。$scriptPathPrefix、$scriptPathSufixも使用できます。</p>
</div>
</body>
</html>